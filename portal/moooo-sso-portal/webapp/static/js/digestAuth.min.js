function GUID(){this.date=new Date,"function"!=typeof this.newGUID&&(GUID.prototype.newGUID=function(){this.date=new Date;for(var e="",t=this.hexadecimal(this.getGUIDDate(),16),r=this.hexadecimal(this.getGUIDTime(),16),o=0;o<9;o++)e+=Math.floor(16*Math.random()).toString(16);for(e+=t,e+=r;e.length<32;)e+=Math.floor(16*Math.random()).toString(16);return this.formatGUID(e)},GUID.prototype.getGUIDDate=function(){return this.date.getFullYear()+this.addZero(this.date.getMonth()+1)+this.addZero(this.date.getDay())},GUID.prototype.getGUIDTime=function(){return this.addZero(this.date.getHours())+this.addZero(this.date.getMinutes())+this.addZero(this.date.getSeconds())+this.addZero(parseInt(this.date.getMilliseconds()/10))},GUID.prototype.addZero=function(e){return"NaN"!=Number(e).toString()&&0<=e&&e<10?"0"+Math.floor(e):e.toString()},GUID.prototype.hexadecimal=function(e,t,r){return null!=r?parseInt(e.toString(),r).toString(t):parseInt(e.toString()).toString(t)},GUID.prototype.formatGUID=function(e){return e.slice(0,8)+""+(e.slice(8,12)+"")+(e.slice(12,16)+"")+(e.slice(16,20)+"")+e.slice(20)})}function Utf8Encode(e){for(var t="",r=0;r<e.length;r++){var o=e.charCodeAt(r);o<128?t+=String.fromCharCode(o):(127<o&&o<2048?t+=String.fromCharCode(o>>6|192):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128)),t+=String.fromCharCode(63&o|128))}return t}$.namespace("Mo.Base.DigestAuth"),Mo.Base.DigestAuth={firstHeader:"",qop:"",realm:"",nonce:"",nc:"",algorithm:"",username:"",password:"",header:null,ajax:function(a){var n=a.error;a.error=function(e,t,r){var o=e.getResponseHeader("WWW-Authenticate");o&&-1!=o.indexOf('stale="true"')?Mo.Base.DigestAuth.sendAgain(e,a,n):n(e,t,r)},Mo.Base.DigestAuth.header&&(a.headers=Mo.Base.DigestAuth.header),$.ajax(a)},sendAgain:function(e,t,r){if(t.error=r,e&&401==e.status){var o=e.getResponseHeader("WWW-Authenticate");this.qop=o.split('qop="')[1].split('"')[0],this.realm=o.split('realm="')[1].split('"')[0],Mo.Base.DigestAuth.realm=this.realm,this.nonce=o.split('nonce="')[1].split('"')[0],this.algorithm=o.split('algorithm="')[1].split('"')[0];var a=t.type,n=t.url;t.headers=Mo.Base.DigestAuth.makeHeader(a,n,this.qop,this.realm,this.nonce,this.algorithm),Mo.Base.DigestAuth.header=t.headers,$.ajax(t)}},makeHeader:function(e,t,r,o,a,n){var s={},i=sm3_encrypt(Utf8Encode(Mo.Base.DigestAuth.username+":"+o+":"+Mo.Base.DigestAuth.password)),h=sm3_encrypt(e+":"+t),d=(1e7*Math.random(1)).toFixed(0),p=(new GUID).newGUID(),g=sm3_encrypt(i+":"+a+":"+d+":"+p+":"+r+":"+h),u=["username*=UTF-8''"+encodeURI(Mo.Base.DigestAuth.username),'realm="'+o+'"','nonce="'+a+'"','uri="'+t+'"',"qop="+r,'cnonce="'+p+'"','response="'+g+'"',"nc="+d].join(",");return s.Authorization="Digest_SM3 "+u,s},makePassword:function(e,t){for(var r=Mo.Base.DigestAuth.username,o=Mo.Base.DigestAuth.realm,a=(new GUID).newGUID(),n=sm3_encrypt(Utf8Encode(r+":"+o+":"+e)).toUpperCase(),s=sm3_encrypt(n+":"+a).toUpperCase(),i=sm3_encrypt(s+":"+a).toUpperCase(),h=sm4_encrypt_ecb(t,s.substring(0,32)).res_ciphertext.toUpperCase(),d=new Array(64),p=new Array(64),g=new Array(64),u=0,c=0;c<d.length;c++)d[c]=0;for(c=u=0;c<i.length;c+=2)d[u++]=parseInt(i.substring(c,c+2),16);var m="",l="",f=0;for(c=0;c<u;c++)f++,p[c]=54^d[c],g[c]=92^d[c],m+=addH16ZeroTwo(p[c].toString(16)),l+=addH16ZeroTwo(g[c].toString(16));for(c=f;c<64;c++)p[c]=54,g[c]=92,m+=addH16ZeroTwo(p[c].toString(16)),l+=addH16ZeroTwo(g[c].toString(16));var D=m+h;return D=l+sm3_byte(toTwoHex(D)).toUpperCase(),{knonce:a,ciphertext:h,hmac:sm3_byte(toTwoHex(D)).toUpperCase()}}};